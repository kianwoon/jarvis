<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Agent Node</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        .info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .code {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        button {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>üöÄ Enhanced Agent Node Frontend Test</h1>
    
    <div class="test-section success">
        <h2>‚úÖ Backend Enhancement Complete!</h2>
        <p>The enhanced agent node schema is working perfectly on the backend:</p>
        <ul>
            <li><strong>state_enabled</strong>: Enable/disable state management</li>
            <li><strong>state_operation</strong>: merge, replace, append, passthrough</li>
            <li><strong>output_format</strong>: text, structured, context, full</li>
            <li><strong>chain_key</strong>: Optional state key for chaining</li>
        </ul>
    </div>

    <div class="test-section info">
        <h2>üîÑ Frontend Component Updated!</h2>
        <p>I've updated the AgentNode.tsx React component with:</p>
        <ul>
            <li>New interface properties for enhanced fields</li>
            <li>State management hooks for the new fields</li>
            <li>Event handlers for field changes</li>
            <li>UI components in the Agent Configuration accordion</li>
            <li>Conditional rendering with "show_when" logic</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üß™ How to Test the Enhanced Features</h2>
        
        <h3>Step 1: Refresh Your Frontend</h3>
        <p>Make sure your React development server is running and refresh your browser:</p>
        <div class="code">npm run dev<br>// Then refresh your browser with Ctrl+F5 or Cmd+Shift+R</div>
        
        <h3>Step 2: Create a New Workflow</h3>
        <p>1. Go to your workflow editor<br>
           2. Drag a new "AI Agent" node onto the canvas<br>
           3. Click to select it and open the properties panel</p>
        
        <h3>Step 3: Look for Enhanced Options</h3>
        <p>In the Agent Configuration accordion, you should now see:</p>
        <div class="code">
üîó Enhanced State Management<br>
‚òê Enable State Management<br><br>

When you check "Enable State Management", these will appear:<br>
‚Ä¢ State Operation (dropdown)<br>
‚Ä¢ Output Format (dropdown)<br>
‚Ä¢ Chain Key (text input)
        </div>
        
        <h3>Step 4: Test Direct Agent Chaining</h3>
        <p>1. Create two AI Agent nodes<br>
           2. Enable "State Management" on both<br>
           3. Connect them directly (Agent 1 ‚Üí Agent 2)<br>
           4. Set different output formats<br>
           5. Run the workflow</p>
    </div>

    <div class="test-section">
        <h2>üîß API Test Commands</h2>
        <p>You can verify the backend is working with these commands:</p>
        
        <button onclick="testAPI()">Test Enhanced Schema API</button>
        <button onclick="testWorkflowValidation()">Test Workflow Validation</button>
        
        <div id="test-results" style="margin-top: 20px;"></div>
    </div>

    <div class="test-section">
        <h2>üìã Next Steps</h2>
        <ol>
            <li><strong>Refresh your frontend</strong> to load the updated AgentNode component</li>
            <li><strong>Create a test workflow</strong> with two connected AI agents</li>
            <li><strong>Enable state management</strong> and try different output formats</li>
            <li><strong>Run the workflow</strong> to see direct agent chaining in action</li>
        </ol>
        
        <p><strong>If you don't see the new options:</strong></p>
        <ul>
            <li>Clear your browser cache completely</li>
            <li>Check the browser console for any React errors</li>
            <li>Restart your React development server</li>
            <li>Verify the AgentNode.tsx file was saved with the updates</li>
        </ul>
    </div>

    <script>
        async function testAPI() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>Testing enhanced schema API...</p>';
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/automation/schema/agent-nodes');
                const data = await response.json();
                
                if (data.schema && data.schema.agentnode && data.schema.agentnode.properties) {
                    const props = data.schema.agentnode.properties;
                    const hasEnhanced = props.state_enabled && props.state_operation && props.output_format && props.chain_key;
                    
                    if (hasEnhanced) {
                        results.innerHTML = `
                            <div class="success">
                                <h4>‚úÖ Enhanced Schema API Working!</h4>
                                <p>Found all enhanced properties:</p>
                                <ul>
                                    <li>state_enabled: ${props.state_enabled ? '‚úÖ' : '‚ùå'}</li>
                                    <li>state_operation: ${props.state_operation ? '‚úÖ' : '‚ùå'}</li>
                                    <li>output_format: ${props.output_format ? '‚úÖ' : '‚ùå'}</li>
                                    <li>chain_key: ${props.chain_key ? '‚úÖ' : '‚ùå'}</li>
                                </ul>
                            </div>
                        `;
                    } else {
                        results.innerHTML = '<div class="error">‚ùå Enhanced properties not found in API response</div>';
                    }
                } else {
                    results.innerHTML = '<div class="error">‚ùå Invalid API response structure</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
            }
        }
        
        async function testWorkflowValidation() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>Testing workflow validation...</p>';
            
            const testWorkflow = {
                nodes: [
                    {
                        id: "agent1",
                        type: "AgentNode",
                        data: {
                            type: "AgentNode",
                            node: {
                                agent_name: "Researcher Agent",
                                state_enabled: true,
                                state_operation: "passthrough",
                                output_format: "structured"
                            }
                        }
                    }
                ],
                edges: []
            };
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/automation/schema/validate-workflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testWorkflow)
                });
                const data = await response.json();
                
                results.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ Workflow Validation Working!</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Validation Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>